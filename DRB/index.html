<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGITAL RADIO BANGLA</title>
    
    <!-- Google Fonts: Poppins (for English) & Hind Siliguri (for Bengali) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Hind+Siliguri:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <style>
        :root {
            --background-dark: #121212;
            --surface-grey: #1e1e1e;
            --primary-text: #ffffff;
            --secondary-text: #b3b3b3;
            --accent-green: #1DB954;
            --hover-grey: #2a2a2a;
            --gemini-purple: #8f94fb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--background-dark);
            color: var(--primary-text);
            font-family: 'Poppins', 'Hind Siliguri', sans-serif;
            line-height: 1.6;
        }

        header {
            padding: 1rem 1.5rem;
            background-color: var(--surface-grey);
            border-bottom: 3px solid var(--accent-green);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #app-title { font-size: 1.75rem; font-weight: 700; }

        .language-switcher {
            display: flex;
            background-color: var(--hover-grey);
            border-radius: 20px;
            overflow: hidden;
        }
        .lang-btn {
            background: none; border: none; color: var(--secondary-text);
            padding: 0.5rem 1rem; cursor: pointer; font-family: inherit;
            transition: all 0.3s ease;
        }
        .lang-btn.active { background-color: var(--accent-green); color: white; }
        
        .container {
            display: flex; flex-direction: column; padding: 2rem 1rem;
            max-width: 1400px; margin: 0 auto; gap: 2rem;
        }

        .main-content { flex: 3; }
        .playlist-container { flex: 1; }

        .video-player-wrapper {
            position: relative; width: 100%; padding-top: 56.25%; 
            background-color: #000; border-radius: 12px; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .now-playing-info { margin-top: 1rem; padding: 0.5rem; }
        #video-title { font-size: 1.5rem; font-weight: 500; }
        #video-channel { font-size: 1rem; color: var(--secondary-text); }

        /* --- Tabs for Notes --- */
        .interactive-panel { background-color: var(--surface-grey); border-radius: 12px; margin-top: 1.5rem; overflow: hidden; }
        .tabs { display: flex; background-color: var(--hover-grey); }
        .tab-button {
            flex: 1; padding: 0.8rem; background: none; border: none;
            color: var(--secondary-text); font-size: 1rem; font-family: inherit;
            cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent;
        }
        .tab-button.active { color: var(--primary-text); border-bottom-color: var(--accent-green); }
        .tab-content { padding: 1rem; }
        #note-textarea {
            width: 100%; height: 200px; background-color: var(--background-dark);
            border: 1px solid var(--hover-grey); border-radius: 8px; color: var(--primary-text);
            font-family: inherit; font-size: 1rem; padding: 0.8rem; resize: vertical;
        }

        /* --- AI Features --- */
        .ai-tools-panel {
            margin-top: 1.5rem;
            background-color: var(--surface-grey);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .ai-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .gemini-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .gemini-button {
            background: linear-gradient(45deg, #4e54c8, var(--gemini-purple));
            color: white; border: none; padding: 0.5rem 1rem; border-radius: 20px;
            cursor: pointer; font-family: inherit; font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gemini-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(143, 148, 251, 0.4);
        }
        .gemini-button:disabled { background: var(--hover-grey); cursor: not-allowed; opacity: 0.6; }
        .form-group { display: flex; align-items: center; gap: 0.5rem; }
        #lang-select {
            background-color: var(--hover-grey); color: var(--primary-text);
            border: 1px solid var(--secondary-text); border-radius: 5px; padding: 0.4rem;
        }

        #ai-output-container {
            margin-top: 1.5rem;
            background-color: var(--background-dark);
            border-radius: 8px; padding: 1.5rem; color: var(--secondary-text);
            border-left: 4px solid var(--gemini-purple); display: none;
            white-space: pre-wrap; /* Allows line breaks from AI to render */
        }
        .ai-output-title { font-weight: 700; color: var(--gemini-purple); margin-bottom: 1rem; }
        
        .loader {
            width: 18px; height: 18px; border: 2px solid #FFF; border-bottom-color: transparent;
            border-radius: 50%; display: inline-block; animation: spin 1s linear infinite; margin-left: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Playlist --- */
        .playlist-container {
             background-color: var(--surface-grey);
             padding: 1.5rem;
             border-radius: 12px;
        }
        .playlist-container h2 { font-size: 1.8rem; margin-bottom: 1rem; border-bottom: 2px solid var(--hover-grey); padding-bottom: 0.5rem;}
        .playlist {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 80vh;
            overflow-y: auto;
        }
        .playlist-item {
            display: flex; align-items: center; padding: 0.75rem; background-color: var(--background-dark);
            border-radius: 8px; cursor: pointer; transition: all 0.3s ease;
            border-left: 4px solid transparent; gap: 1rem;
        }
        .playlist-item:hover { background-color: var(--hover-grey); transform: translateX(5px); }
        .playlist-item.active { background-color: var(--hover-grey); border-left-color: var(--accent-green); }
        .playlist-item-thumbnail { width: 80px; height: 45px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .playlist-item-info h3 { font-size: 1rem; font-weight: 500; }

        @media (min-width: 992px) {
            .container { flex-direction: row; }
            header h1 { font-size: 2.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1 id="app-title"></h1>
        <div class="language-switcher">
            <button class="lang-btn active" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="bn">BN</button>
        </div>
    </header>

    <main class="container">
        <section class="main-content">
            <div class="video-player-wrapper"><div id="player"></div></div>
            <div class="now-playing-info">
                <h2 id="video-title"></h2><p id="video-channel"></p>
            </div>

            <div class="interactive-panel">
                <div class="tabs">
                    <button id="notes-tab-btn" class="tab-button active"></button>
                </div>
                <div id="notes-content" class="tab-content">
                    <textarea id="note-textarea"></textarea>
                </div>
            </div>

            <div class="ai-tools-panel">
                <div class="ai-controls">
                    <div class="gemini-actions">
                        <button class="gemini-button" id="summarize-btn"></button>
                        <button class="gemini-button" id="quiz-btn"></button>
                        <button class="gemini-button" id="knowledge-btn"></button>
                    </div>
                    <div class="form-group">
                        <label for="lang-select" id="lang-select-label"></label>
                        <select id="lang-select">
                            <option value="English">English</option>
                            <option value="Bengali">Bengali</option>
                        </select>
                    </div>
                </div>
                <div id="ai-output-container"></div>
            </div>
        </section>

        <aside class="playlist-container">
            <h2 id="playlist-title"></h2>
            <div id="playlist" class="playlist"></div>
        </aside>
    </main>
    
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        // --- 1. LANGUAGE & TEXT MANAGEMENT ---
        const langStrings = {
            en: {
                appTitle: "Bengali Music Showcase",
                welcomeTitle: "Welcome!",
                welcomeChannel: "Please select a song from the playlist.",
                notesTab: "My Sticky Notes",
                notesPlaceholder: "Write your thoughts about this song...",
                playlistTitle: "Playlist",
                summarizeBtn: "‚ú® Summarize",
                quizBtn: "‚ùì Quiz Me",
                knowledgeBtn: "üìö Knowledge Base",
                langSelectLabel: "AI Language:",
                aiOutputTitleSummary: "AI Summary",
                aiOutputTitleQuiz: "AI Quiz",
                aiOutputTitleKnowledge: "AI Knowledge Base",
                error: "Sorry, an error occurred. Please try again."
            },
            bn: {
                appTitle: "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ó‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ü‡¶∏‡¶∞",
                welcomeTitle: "‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!",
                welcomeChannel: "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶≤‡ßá‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ó‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
                notesTab: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶ø ‡¶®‡ßã‡¶ü",
                notesPlaceholder: "‡¶è‡¶á ‡¶ó‡¶æ‡¶®‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶¨‡¶®‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...",
                playlistTitle: "‡¶ó‡¶æ‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ",
                summarizeBtn: "‚ú® ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™",
                quizBtn: "‚ùì ‡¶ï‡ßÅ‡¶á‡¶ú",
                knowledgeBtn: "üìö ‡¶ú‡ßç‡¶û‡¶æ‡¶®‡¶≠‡¶æ‡¶®‡ßç‡¶°‡¶æ‡¶∞",
                langSelectLabel: "AI ‡¶≠‡¶æ‡¶∑‡¶æ:",
                aiOutputTitleSummary: "AI ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™",
                aiOutputTitleQuiz: "AI ‡¶ï‡ßÅ‡¶á‡¶ú",
                aiOutputTitleKnowledge: "AI ‡¶ú‡ßç‡¶û‡¶æ‡¶®‡¶≠‡¶æ‡¶®‡ßç‡¶°‡¶æ‡¶∞",
                error: "‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"
            }
        };

        let currentLang = 'en';

        function updateUI(lang) {
            currentLang = lang;
            const s = langStrings[lang];
            // Update all static text elements
            document.documentElement.lang = lang;
            document.getElementById('app-title').textContent = s.appTitle;
            if (!player || player.getPlayerState() !== 1) { // Only update if not playing
                document.getElementById('video-title').textContent = s.welcomeTitle;
                document.getElementById('video-channel').textContent = s.welcomeChannel;
            }
            document.getElementById('notes-tab-btn').textContent = s.notesTab;
            document.getElementById('note-textarea').placeholder = s.notesPlaceholder;
            document.getElementById('playlist-title').textContent = s.playlistTitle;
            document.getElementById('summarize-btn').innerHTML = s.summarizeBtn;
            document.getElementById('quiz-btn').innerHTML = s.quizBtn;
            document.getElementById('knowledge-btn').innerHTML = s.knowledgeBtn;
            document.getElementById('lang-select-label').textContent = s.langSelectLabel;
            
            // Update language switcher style
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
        }

        // --- 2. DATA ---
        const videoPlaylist = [
            { id: 'NjtvFqeCoXE', title: 'Manob Kolyan | ‡¶Æ‡¶æ‡¶®‡¶¨ ‡¶ï‡¶≤‡ßç‡¶Ø‡¶æ‡¶£ | ‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶´‡¶ú‡¶≤ | HSC AudioBook | Digital Radio Bangla | Bangla Academic HSC Dilam', channel: 'Digital Radio Bangla' },
            { id: '_pg9dzPjTPQ', title: 'Aparichita | ‡¶Ö‡¶™‡¶∞‡¶ø‡¶ö‡¶ø‡¶§‡¶æ | Rabi Tagore| ‡¶∞‡¶¨‡ßÄ‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶®‡¶æ‡¶• ‡¶†‡¶æ‡¶ï‡ßÅ‡¶∞ | HSC | HSC AudioBook | Digital Radio Bangla', channel: 'Digital Radio Bangla' },
            { id: '1b2A2srXNTk', title: 'Necklace | ‡¶®‡ßá‡¶ï‡¶≤‡ßá‡¶∏ ‡•§ ‡¶ó‡ßÄ ‡¶¶‡ßç‡¶Ø ‡¶Æ‡ßã‡¶™‡¶æ‡¶∏‡¶æ‡¶Å ‡•§ HSC | Audiobook | Digital Radio Bangla | ‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡ßá‡¶®‡ßç‡¶¶‡ßÅ ‡¶¶‡¶∏‡ßç‡¶§‡¶ø‡¶¶‡¶æ‡¶∞', channel: 'Digital Radio Bangla' },
            { id: 'TAyR0VA-jcI', title: 'Manob Kolyan | ‡¶Æ‡¶æ‡¶®‡¶¨ ‡¶ï‡¶≤‡ßç‡¶Ø‡¶æ‡¶£ | ‡¶Ü‡¶¨‡ßÅ‡¶≤ ‡¶´‡¶ú‡¶≤ | HSC | Audiobook | Digital Radio Bangla | Bangla Academic HSC', channel: 'Digital Radio Bangla' },
            { id: 'w0QdcL4HvLU', title: 'Mashi Pishi | ‡¶Æ‡¶æ‡¶∏‡¶ø - ‡¶™‡¶ø‡¶∏‡¶ø | ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï ‡¶¨‡¶®‡ßç‡¶¶‡ßç‡¶Ø‡ßã‡¶™‡¶æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º | HSC | Digital Radio Bangla | Bangla Audiobook |', channel: 'Digital Radio Bangla' },
            { id: 'VEYzzU_flCg', title: 'AMAR POTH | ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶• | Kazi Nazrul Islam | ‡¶ï‡¶æ‡¶ú‡ßÄ ‡¶®‡¶ú‡¶∞‡ßÅ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ | HSC AudioBook | Digital Radio Bangla', channel: 'Digital Radio Bangla' }
        ];

        let player;
        let currentVideoIndex = 0;

        // --- 3. GEMINI API INTEGRATION ---
        const apiKey = "AIzaSyDBXVrObWTuXlmt_2JOqs61OQ5UemScXTo"; // IMPORTANT: API key is handled by the execution environment.
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        async function callGeminiAPI(prompt, button) {
            const outputContainer = document.getElementById('ai-output-container');
            const originalButtonText = button.innerHTML;
            
            // Disable all AI buttons and show loading state
            document.querySelectorAll('.gemini-button').forEach(btn => btn.disabled = true);
            button.innerHTML += '<span class="loader"></span>';
            outputContainer.style.display = 'block';
            outputContainer.innerHTML = 'Generating...';

            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate?.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text.replace(/\n/g, '<br>');
                } else {
                    console.error("Invalid response structure from API:", result);
                    return langStrings[currentLang].error;
                }
            } catch (error) {
                console.error("Gemini API call failed:", error);
                return langStrings[currentLang].error;
            } finally {
                // Restore all buttons
                document.querySelectorAll('.gemini-button').forEach(btn => btn.disabled = false);
                button.innerHTML = originalButtonText;
            }
        }
        
        async function handleAIAction(action) {
            if (!player || typeof player.getPlayerState !== 'function' || player.getPlayerState() !== 1) {
                // If no video is playing, don't call the API
                alert(currentLang === 'en' ? 'Please play a video first!' : '‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®!');
                return;
            }

            const video = videoPlaylist[currentVideoIndex];
            const aiLang = document.getElementById('lang-select').value;
            const outputContainer = document.getElementById('ai-output-container');
            let prompt = '';
            let button;
            let titleKey = '';
            
            const baseInstruction = `You are a music and cultural expert. For the Bengali song titled "${video.title}", perform the following action and respond in ${aiLang}:`;

            switch(action) {
                case 'summarize':
                    prompt = `${baseInstruction} Provide a concise, one-paragraph summary of the song's main theme and emotional tone.`;
                    button = document.getElementById('summarize-btn');
                    titleKey = 'aiOutputTitleSummary';
                    break;
                case 'quiz':
                    prompt = `${baseInstruction} Create a short, fun, multiple-choice quiz with 3 questions about the song's potential themes or lyrical content. Provide the correct answer for each question.`;
                    button = document.getElementById('quiz-btn');
                    titleKey = 'aiOutputTitleQuiz';
                    break;
                case 'knowledge':
                    prompt = `${baseInstruction} Provide a detailed 'Knowledge Base' entry. Cover: 1) Core Theme & Meaning, 2) Potential Cultural Context, and 3) The mood or feeling the music evokes.`;
                    button = document.getElementById('knowledge-btn');
                    titleKey = 'aiOutputTitleKnowledge';
                    break;
            }

            const result = await callGeminiAPI(prompt, button);
            outputContainer.innerHTML = `<h3 class="ai-output-title">${langStrings[currentLang][titleKey]}</h3><p>${result}</p>`;
        }
        
        // --- 4. YOUTUBE API & PLAYER LOGIC ---
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '390', width: '640',
                playerVars: { 'playsinline': 1, 'rel': 0 },
                events: { 'onReady': onPlayerReady }
            });
        }

        function onPlayerReady(event) {
            setupEventListeners();
            updateUI(currentLang); // Initial UI setup
            buildPlaylist();
            updateActivePlaylistItem(currentVideoIndex); // Set initial active item
            loadNote();
        }

        // --- 5. UI & INTERACTIVITY ---
        function setupEventListeners() {
            // Language switchers
            document.querySelectorAll('.lang-btn').forEach(btn => btn.addEventListener('click', (e) => updateUI(e.target.dataset.lang)));
            
            // AI action buttons
            document.getElementById('summarize-btn').addEventListener('click', () => handleAIAction('summarize'));
            document.getElementById('quiz-btn').addEventListener('click', () => handleAIAction('quiz'));
            document.getElementById('knowledge-btn').addEventListener('click', () => handleAIAction('knowledge'));
            
            // Sticky note
            document.getElementById('note-textarea').addEventListener('input', saveNote);
        }

        function buildPlaylist() {
            const playlistContainer = document.getElementById('playlist');
            playlistContainer.innerHTML = ''; // Clear previous playlist
            videoPlaylist.forEach((video, index) => {
                const item = document.createElement('div');
                item.className = 'playlist-item';
                item.dataset.index = index;

                const thumbnail = document.createElement('img');
                thumbnail.className = 'playlist-item-thumbnail';
                thumbnail.src = `https://i.ytimg.com/vi/${video.id}/hqdefault.jpg`;
                thumbnail.alt = video.title;
                
                const info = document.createElement('div');
                info.className = 'playlist-item-info';
                
                const title = document.createElement('h3');
                title.textContent = video.title;

                info.appendChild(title);
                item.appendChild(thumbnail);
                item.appendChild(info);
                
                item.addEventListener('click', () => { loadVideo(index); });
                playlistContainer.appendChild(item);
            });
        }
        
        function loadVideo(index) {
            if (index < 0 || index >= videoPlaylist.length) return;
            
            currentVideoIndex = index;
            player.loadVideoById(videoPlaylist[index].id);
            updateNowPlaying(index);
            updateActivePlaylistItem(index);
            loadNote(); // Load the note for the new video

            document.getElementById('ai-output-container').style.display = 'none'; // Hide AI output
        }

        function updateNowPlaying(index) {
            const video = videoPlaylist[index];
            document.getElementById('video-title').textContent = video.title;
            document.getElementById('video-channel').textContent = video.channel;
        }

        function updateActivePlaylistItem(activeIndex) {
            document.querySelectorAll('.playlist-item').forEach((item, index) => {
                item.classList.toggle('active', index === activeIndex);
            });
        }

        // --- 6. STICKY NOTES LOGIC (localStorage) ---
        function saveNote() {
            const videoId = videoPlaylist[currentVideoIndex].id;
            const noteText = document.getElementById('note-textarea').value;
            localStorage.setItem(`note_${videoId}`, noteText);
        }

        function loadNote() {
            // Don't try to load a note if no video is selected yet.
            if (currentVideoIndex < 0 || currentVideoIndex >= videoPlaylist.length) return;
            
            const videoId = videoPlaylist[currentVideoIndex].id;
            const savedNote = localStorage.getItem(`note_${videoId}`) || '';
            document.getElementById('note-textarea').value = savedNote;
        }
    </script>
</body>
</html>
